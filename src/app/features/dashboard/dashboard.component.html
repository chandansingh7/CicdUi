<div class="page-header">
  <h2>Dashboard</h2>
  <span class="text-muted">{{ today | date:'fullDate' }}</span>
</div>

<div *ngIf="loading" class="loading-center">
  <mat-spinner diameter="48"></mat-spinner>
</div>

<div *ngIf="!loading">
  <div class="stats-grid">
    <mat-card class="stat-card primary-card">
      <mat-card-content>
        <mat-icon>receipt_long</mat-icon>
        <div class="stat-value">{{ dailyReport?.totalOrders || 0 }}</div>
        <div class="stat-label">Today's Orders</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card success-card">
      <mat-card-content>
        <mat-icon>payments</mat-icon>
        <div class="stat-value">${{ (dailyReport?.totalRevenue || 0) | number:'1.2-2' }}</div>
        <div class="stat-label">Today's Revenue</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card accent-card">
      <mat-card-content>
        <mat-icon>trending_up</mat-icon>
        <div class="stat-value">${{ (dailyReport?.averageOrderValue || 0) | number:'1.2-2' }}</div>
        <div class="stat-label">Avg. Order Value</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card warn-card">
      <mat-card-content>
        <mat-icon>warning</mat-icon>
        <div class="stat-value">{{ lowStockCount }}</div>
        <div class="stat-label">Low Stock Alerts</div>
      </mat-card-content>
    </mat-card>
  </div>

  <mat-card class="card mt-16" *ngIf="dailyReport?.topProducts?.length">
    <mat-card-header>
      <mat-card-title>Top Products Today</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="dailyReport!.topProducts" class="full-width">
        <ng-container matColumnDef="rank">
          <th mat-header-cell *matHeaderCellDef>#</th>
          <td mat-cell *matCellDef="let item; let i = index">{{ i + 1 }}</td>
        </ng-container>
        <ng-container matColumnDef="productName">
          <th mat-header-cell *matHeaderCellDef>Product</th>
          <td mat-cell *matCellDef="let item">{{ item.productName }}</td>
        </ng-container>
        <ng-container matColumnDef="unitsSold">
          <th mat-header-cell *matHeaderCellDef class="text-right">Units Sold</th>
          <td mat-cell *matCellDef="let item" class="text-right">{{ item.unitsSold }}</td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="topProductsColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: topProductsColumns;"></tr>
      </table>
    </mat-card-content>
  </mat-card>

  <mat-card class="card mt-16 empty-state" *ngIf="!dailyReport?.topProducts?.length">
    <mat-card-content>
      <mat-icon>bar_chart</mat-icon>
      <p>No sales data for today yet. Start making sales from the <a routerLink="/app/pos">POS screen</a>.</p>
    </mat-card-content>
  </mat-card>
</div>
