<div class="page-header">
  <h2>Company & Receipt Settings</h2>
  <div class="header-actions">
    <button mat-raised-button color="primary" (click)="save()" [disabled]="form.invalid || saving">
      <mat-icon>save</mat-icon> {{ saving ? 'Saving...' : 'Save' }}
    </button>
  </div>
</div>

<div *ngIf="loading" class="loading-center"><mat-spinner diameter="40"></mat-spinner></div>

<mat-card class="card" *ngIf="!loading">
  <mat-card-header>
    <mat-card-title>Company details</mat-card-title>
    <mat-card-subtitle>Shown on logo, bills and receipts</mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    <form [formGroup]="form" class="settings-form">
      <mat-form-field appearance="outline" class="full-width" subscriptSizing="dynamic">
        <mat-label>Company name</mat-label>
        <input matInput formControlName="name" placeholder="My Store">
        <mat-hint>Displayed as app logo and on receipts</mat-hint>
      </mat-form-field>
      <div class="upload-row">
        <div class="upload-block">
          <label class="upload-label">Logo</label>
          <div class="upload-preview" *ngIf="logoImageUrl">
            <img [src]="logoImageUrl" alt="Logo" class="preview-img logo-preview">
          </div>
          <div class="upload-actions">
            <input #logoInput type="file" accept="image/*" hidden (change)="onLogoSelected($event)">
            <button mat-stroked-button type="button" (click)="logoInput.click()" [disabled]="saving">
              <mat-icon>upload</mat-icon> {{ company?.logoUrl ? 'Replace logo' : 'Upload logo' }}
            </button>
          </div>
        </div>
        <div class="upload-block">
          <label class="upload-label">Favicon</label>
          <div class="upload-preview" *ngIf="faviconImageUrl">
            <img [src]="faviconImageUrl" alt="Favicon" class="preview-img favicon-preview">
          </div>
          <div class="upload-actions">
            <input #faviconInput type="file" accept="image/*" hidden (change)="onFaviconSelected($event)">
            <button mat-stroked-button type="button" (click)="faviconInput.click()" [disabled]="saving">
              <mat-icon>upload</mat-icon> {{ company?.faviconUrl ? 'Replace favicon' : 'Upload favicon' }}
            </button>
          </div>
        </div>
      </div>
      <mat-form-field appearance="outline" class="full-width" subscriptSizing="dynamic">
        <mat-label>Address</mat-label>
        <input matInput formControlName="address" placeholder="123 Main St">
      </mat-form-field>
      <mat-form-field appearance="outline" class="full-width" subscriptSizing="dynamic">
        <mat-label>Phone</mat-label>
        <input matInput formControlName="phone" placeholder="+1 234 567 8900">
      </mat-form-field>
      <mat-form-field appearance="outline" class="full-width" subscriptSizing="dynamic">
        <mat-label>Email</mat-label>
        <input matInput type="email" formControlName="email" placeholder="store@example.com">
      </mat-form-field>
      <mat-form-field appearance="outline" class="full-width" subscriptSizing="dynamic">
        <mat-label>Tax ID</mat-label>
        <input matInput formControlName="taxId" placeholder="Optional">
      </mat-form-field>
      <mat-form-field appearance="outline" class="full-width" subscriptSizing="dynamic">
        <mat-label>Website</mat-label>
        <input matInput formControlName="website" placeholder="https://...">
      </mat-form-field>
    </form>
  </mat-card-content>
</mat-card>

<mat-card class="card" *ngIf="!loading">
  <mat-card-header>
    <mat-card-title>Receipt / Bill settings</mat-card-title>
    <mat-card-subtitle>Paper size and text on printed receipts</mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    <form [formGroup]="form" class="settings-form">
      <mat-form-field appearance="outline" class="full-width" subscriptSizing="dynamic">
        <mat-label>Receipt paper size</mat-label>
        <mat-select formControlName="receiptPaperSize">
          <mat-option *ngFor="let opt of receiptPaperSizes" [value]="opt.value">{{ opt.label }}</mat-option>
        </mat-select>
        <mat-hint>58mm / 80mm for thermal printers, A4 for standard</mat-hint>
      </mat-form-field>
      <mat-form-field appearance="outline" class="full-width" subscriptSizing="dynamic">
        <mat-label>Receipt header text</mat-label>
        <input matInput formControlName="receiptHeaderText" placeholder="Optional line above company name">
      </mat-form-field>
      <mat-form-field appearance="outline" class="full-width" subscriptSizing="dynamic">
        <mat-label>Receipt footer text</mat-label>
        <input matInput formControlName="receiptFooterText" placeholder="e.g. Thank you for your purchase!">
      </mat-form-field>
    </form>
  </mat-card-content>
</mat-card>
