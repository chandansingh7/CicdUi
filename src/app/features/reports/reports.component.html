<div class="page-header">
  <h2>Sales Reports</h2>
</div>

<div class="tab-bar">
  <button mat-button [class.active-tab]="activeTab === 'daily'" (click)="switchTab('daily')">
    <mat-icon>today</mat-icon> Daily Report
  </button>
  <button mat-button [class.active-tab]="activeTab === 'monthly'" (click)="switchTab('monthly')">
    <mat-icon>calendar_month</mat-icon> Monthly Report
  </button>
</div>

<div *ngIf="activeTab === 'daily'">
  <div class="filter-bar">
    <mat-form-field appearance="outline">
      <mat-label>Date</mat-label>
      <input matInput [matDatepicker]="picker" [formControl]="dateControl">
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>
    <button mat-raised-button color="primary" (click)="loadDaily()">
      <mat-icon>search</mat-icon> Load Report
    </button>
    <button mat-stroked-button (click)="downloadDailyExcel()" [disabled]="loadingDaily">
      <mat-icon>download</mat-icon> Download Excel
    </button>
  </div>

  <div *ngIf="loadingDaily" class="loading-center"><mat-spinner diameter="48"></mat-spinner></div>

  <ng-container *ngIf="!loadingDaily && dailyReport">
    <div class="stats-grid">
      <mat-card class="stat-card primary-card">
        <mat-card-content>
          <mat-icon>receipt_long</mat-icon>
          <div class="stat-value">{{ dailyReport.totalOrders }}</div>
          <div class="stat-label">Total Orders</div>
        </mat-card-content>
      </mat-card>
      <mat-card class="stat-card success-card">
        <mat-card-content>
          <mat-icon>payments</mat-icon>
          <div class="stat-value">${{ dailyReport.totalRevenue | number:'1.2-2' }}</div>
          <div class="stat-label">Total Revenue</div>
        </mat-card-content>
      </mat-card>
      <mat-card class="stat-card accent-card">
        <mat-card-content>
          <mat-icon>trending_up</mat-icon>
          <div class="stat-value">${{ dailyReport.averageOrderValue | number:'1.2-2' }}</div>
          <div class="stat-label">Average Order</div>
        </mat-card-content>
      </mat-card>
    </div>

    <mat-card class="card mt-16" *ngIf="dailyReport.topProducts?.length">
      <mat-card-header><mat-card-title>Top Products — {{ dailyReport.period }}</mat-card-title></mat-card-header>
      <mat-card-content>
        <table mat-table [dataSource]="dailyReport.topProducts" class="full-width">
          <ng-container matColumnDef="rank"><th mat-header-cell *matHeaderCellDef>#</th><td mat-cell *matCellDef="let r; let i = index">{{ i+1 }}</td></ng-container>
          <ng-container matColumnDef="productName"><th mat-header-cell *matHeaderCellDef>Product</th><td mat-cell *matCellDef="let r">{{ r.productName }}</td></ng-container>
          <ng-container matColumnDef="unitsSold"><th mat-header-cell *matHeaderCellDef class="text-right">Units Sold</th><td mat-cell *matCellDef="let r" class="text-right">{{ r.unitsSold }}</td></ng-container>
          <tr mat-header-row *matHeaderRowDef="topProductsColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: topProductsColumns;"></tr>
        </table>
      </mat-card-content>
    </mat-card>
    <div *ngIf="!dailyReport.topProducts?.length" class="empty-state">
      <mat-icon>bar_chart</mat-icon><p>No sales data for this date.</p>
    </div>
  </ng-container>
</div>

<div *ngIf="activeTab === 'monthly'">
  <div class="filter-bar">
    <mat-form-field appearance="outline">
      <mat-label>Year</mat-label>
      <input matInput type="number" [formControl]="yearControl" min="2020">
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Month</mat-label>
      <mat-select [formControl]="monthControl">
        <mat-option *ngFor="let m of months" [value]="m.value">{{ m.label }}</mat-option>
      </mat-select>
    </mat-form-field>
    <button mat-raised-button color="primary" (click)="loadMonthly()">
      <mat-icon>search</mat-icon> Load Report
    </button>
    <button mat-stroked-button (click)="downloadMonthlyExcel()" [disabled]="loadingMonthly">
      <mat-icon>download</mat-icon> Download Excel
    </button>
  </div>

  <div *ngIf="loadingMonthly" class="loading-center"><mat-spinner diameter="48"></mat-spinner></div>

  <ng-container *ngIf="!loadingMonthly && monthlyReport">
    <div class="stats-grid">
      <mat-card class="stat-card primary-card">
        <mat-card-content>
          <mat-icon>receipt_long</mat-icon>
          <div class="stat-value">{{ monthlyReport.totalOrders }}</div>
          <div class="stat-label">Total Orders</div>
        </mat-card-content>
      </mat-card>
      <mat-card class="stat-card success-card">
        <mat-card-content>
          <mat-icon>payments</mat-icon>
          <div class="stat-value">${{ monthlyReport.totalRevenue | number:'1.2-2' }}</div>
          <div class="stat-label">Total Revenue</div>
        </mat-card-content>
      </mat-card>
      <mat-card class="stat-card accent-card">
        <mat-card-content>
          <mat-icon>trending_up</mat-icon>
          <div class="stat-value">${{ monthlyReport.averageOrderValue | number:'1.2-2' }}</div>
          <div class="stat-label">Average Order</div>
        </mat-card-content>
      </mat-card>
    </div>

    <mat-card class="card mt-16" *ngIf="monthlyReport.topProducts?.length">
      <mat-card-header><mat-card-title>Top Products — {{ monthlyReport.period }}</mat-card-title></mat-card-header>
      <mat-card-content>
        <table mat-table [dataSource]="monthlyReport.topProducts" class="full-width">
          <ng-container matColumnDef="rank"><th mat-header-cell *matHeaderCellDef>#</th><td mat-cell *matCellDef="let r; let i = index">{{ i+1 }}</td></ng-container>
          <ng-container matColumnDef="productName"><th mat-header-cell *matHeaderCellDef>Product</th><td mat-cell *matCellDef="let r">{{ r.productName }}</td></ng-container>
          <ng-container matColumnDef="unitsSold"><th mat-header-cell *matHeaderCellDef class="text-right">Units Sold</th><td mat-cell *matCellDef="let r" class="text-right">{{ r.unitsSold }}</td></ng-container>
          <tr mat-header-row *matHeaderRowDef="topProductsColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: topProductsColumns;"></tr>
        </table>
      </mat-card-content>
    </mat-card>
  </ng-container>
</div>
